<script>
const params = new URLSearchParams(window.location.search);
const token = params.get("t");

fetch(`https://script.google.com/macros/s/AKfycbzoOgcuBy6LzaSWAfKkorZ-Pk-4nORjJAfyoTufBMmcvZL2O22HelPJi8zMFLWZ8dtu/exec?t=${token}`)
  .then(res => res.json())
  .then(data => {
    if (data.error) {
      document.getElementById("welcome").innerText = data.error;
      return;
    }

    document.getElementById("welcome").innerText =
      `Welcome, ${data.name} ðŸ’`;

    if (data.responded) {
      document.getElementById("welcome").innerText +=
        "\n\nWeâ€™ve already received your RSVP ðŸ’•";
      return;
    }

    document.getElementById("rsvpForm").style.display = "block";

    if (data.allowPlusOne === "YES") {
      document.getElementById("plusOneSection").style.display = "block";
    }

    if (data.rsvpClosed) {
  document.getElementById("welcome").innerText +=
    "\n\nRSVP is now closed. We canâ€™t wait to celebrate with you ðŸ’•";
  return;
}

  });

document.getElementById("rsvpForm").addEventListener("submit", e => {
  e.preventDefault();

  fetch("https://script.google.com/macros/s/AKfycbzoOgcuBy6LzaSWAfKkorZ-Pk-4nORjJAfyoTufBMmcvZL2O22HelPJi8zMFLWZ8dtu/exec", {
    method: "POST",
    body: JSON.stringify({
      token: token,
      rsvp: document.getElementById("rsvp").value,
      bringingPlusOne:
        document.getElementById("bringingPlusOne")?.value || "N/A",
      plusOneName:
        document.getElementById("plusOneName")?.value || ""
    })
  })
  .then(res => res.json())
  .then(resp => {
    if (resp.error) {
      alert("RSVP already submitted.");
      return;
    }
    alert("RSVP submitted ðŸ’•");
    document.getElementById("rsvpForm").style.display = "none";
  });
});
</script>
