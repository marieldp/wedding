<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wedding Invitation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<h1 id="welcome">Loading...</h1>

<form id="rsvpForm" style="display:none;">
  <p>Will you attend?</p>
  <select id="rsvp">
    <option value="Yes">Yes</option>
    <option value="No">No</option>
  </select>

  <div id="plusOneSection" style="display:none;">
    <p>Will you bring a +1?</p>
    <select id="bringingPlusOne">
      <option value="Yes">Yes</option>
      <option value="No">No</option>
    </select>

    <input type="text" id="plusOneName" placeholder="Plus one name">
  </div>

  <br><br>
  <button type="submit">Submit RSVP</button>
</form>

<script>
const params = new URLSearchParams(window.location.search);
const token = params.get("t");

if (!token) {
  document.getElementById("welcome").innerText = "Invalid invitation link.";
}

fetch(`https://script.google.com/macros/s/AKfycbzoOgcuBy6LzaSWAfKkorZ-Pk-4nORjJAfyoTufBMmcvZL2O22HelPJi8zMFLWZ8dtu/exec?t=${token}`)
  .then(res => res.json())
  .then(data => {
    if (data.error) {
      document.getElementById("welcome").innerText = data.error;
      return;
    }

    document.getElementById("welcome").innerText =
      `Welcome, ${data.name} ðŸ’`;

    document.getElementById("rsvpForm").style.display = "block";

    if (data.allowPlusOne === "YES") {
      document.getElementById("plusOneSection").style.display = "block";
    }
  });

document.getElementById("rsvpForm").addEventListener("submit", e => {
  e.preventDefault();

  fetch("https://script.google.com/macros/s/AKfycbzoOgcuBy6LzaSWAfKkorZ-Pk-4nORjJAfyoTufBMmcvZL2O22HelPJi8zMFLWZ8dtu/exec", {
    method: "POST",
    body: JSON.stringify({
      token: token,
      rsvp: document.getElementById("rsvp").value,
      bringingPlusOne:
        document.getElementById("bringingPlusOne")?.value || "N/A",
      plusOneName:
        document.getElementById("plusOneName")?.value || ""
    })
  }).then(() => {
    alert("RSVP submitted ðŸ’•");
    document.getElementById("rsvpForm").style.display = "none";
  });
});
</script>

</body>
</html>
